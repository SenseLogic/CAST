<meta charset="utf-8">
<style>
    *
    {
        padding : 0;
        margin : 0;
    }

    textarea
    {
        height: 85vh;
        width: 100%;
    }

    input[ type=checkbox ]
    {
        transform : scale( 0.8 );

        margin-right : 0.2rem;
    }

    .code-grid
    {
        padding: 1vh;

        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .option-grid
    {
        padding: 0 1vh;

        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .case-grid
    {
        padding: 1vh;

        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .button-grid
    {
        padding: 1vh;

        display: flex;
        justify-content: end;
        align-items: end;
    }
</style>
<div class="code-grid">
    <div>
        <textarea id="old-code" placeholder="Old code" spellcheck="false"></textarea>
    </div>
    <div>
        <textarea id="new-code" placeholder="New code" spellcheck="false"></textarea>
    </div>
</div>
<div class="option-grid">
    <div class="case-grid">
        <div>
            SCREAM_CASE :
        </div>
        <select id="scream-case">
            <option value="SCREAM_CASE">
                SCREAM_CASE
            </option>
            <option value="PascalCase" selected>
                PascalCase
            </option>
            <option value="snake_case">
                snake_case
            </option>
            <option value="camelCase">
                camelCase
            </option>
        </select>
        <div>
            snake_case :
        </div>
        <select id="snake-case">
            <option value="SCREAM_CASE">
                SCREAM_CASE
            </option>
            <option value="PascalCase">
                PascalCase
            </option>
            <option value="snake_case">
                snake_case
            </option>
            <option value="camelCase" selected>
                camelCase
            </option>
        </select>
        <div>
            PascalCase :
        </div>
        <select id="pascal-case">
            <option value="SCREAM_CASE">
                SCREAM_CASE
            </option>
            <option value="PascalCase">
                PascalCase
            </option>
            <option value="snake_case">
                snake_case
            </option>
            <option value="camelCase" selected>
                camelCase
            </option>
        </select>
        <div>
            camelCase :
        </div>
        <select id="camel-case">
            <option value="SCREAM_CASE">
                SCREAM_CASE
            </option>
            <option value="PascalCase">
                PascalCase
            </option>
            <option value="snake_case">
                snake_case
            </option>
            <option value="camelCase" selected>
                camelCase
            </option>
        </select>
    </div>
    <div>
        <div>
            <input id="braces" type="checkbox" checked/> Braces
        </div>
        <div>
            <input id="brackets" type="checkbox" checked/> Brackets
        </div>
        <div>
            <input id="identifiers" type="checkbox" checked/> Identifiers
        </div>
    </div>
    <div class="button-grid">
        <button onclick="FixCode()" style="font-size: 1.5vh; padding: 0.5vh">Fix</button>
    </div>
</div>
<script>
    // -- VARIABLES

    var
        ScreamCaseIdentifierCase = "PascalCase",
        PascalCaseIdentifierCase = "camelCase",
        SnakeCaseIdentifierCase = "camelCase",
        CamelCaseIdentifierCase = "camelCase";

    // -- FUNCTIONS

    function FixBraces(
        code
        )
    {
        return (
            code
                .replace(
                    /^( *)([^\n]*)\{\s*$/gm,
                    function ( match, indentation, code )
                    {
                        if ( code === "" )
                        {
                            return indentation + '{';
                        }
                        else
                        {
                            return indentation + code + '\n' + indentation + '{';
                        }
                    }
                    )
                .replace(
                    /^( *)} else\s*$/gm,
                    function ( match, indentation )
                    {
                        console.log( '|'+match+'|'+indentation+'|' );
                        return indentation + '}\n' + indentation + 'else';
                    }
                    )
            );
    }

    // ~~

    function FixBrackets(
        code
        )
    {
        return (
            code
                .replace( /\[(?=[^\s])/g, '[ ' )
                .replace( /(?<=[^\s])\]/g, ' ]' )
                .replaceAll( "[ ]", "[]" )
            );
    }

    // ~~

    function FixParentheses(
        code
        )
    {
        return (
            code
                .replace( /\((?=[^\s])/g, '( ' )
                .replace( /(?<=[^\s])\)/g, ' )' )
                .replaceAll( "( )", "()" )
            );
    }

    // ~~

    function GetIdentifierCase(
        identifier
        )
    {
        if ( /^[A-Z][A-Z0-9]*(_[A-Z0-9]+)+$/.test( identifier ) )
        {
            return "SCREAM_CASE";
        }
        else if ( /^[A-Z][a-z0-9]*[a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "PascalCase";
        }
        else if ( /^[a-z][a-z0-9]*(_[a-z0-9]+)+$/.test( identifier ) )
        {
            return "snake_case";
        }
        else if ( /^[a-z][a-z0-9]*[a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "camelCase";
        }
        else
        {
            return "";
        }
    }

    // ~~

    function GetIdentifierWordArray(
        identifier,
        identifier_case
        )
    {
        if ( identifier_case === "SCREAM_CASE"
             || identifier_case === "snake_case" )
        {
            return identifier.split( '_' );
        }
        else if ( identifier_case === "PascalCase"
                  || identifier_case === "camelCase" )
        {
            return identifier.split( /(?=[A-Z])/ ).map( word => word.toLowerCase() );
        }
        else
        {
            return [ identifier ];
        }
    }

    // ~~

    function GetFixedIdentifier(
        identifier,
        old_identifier_case,
        new_identifier_case
        )
    {
        let identifier_word_array = GetIdentifierWordArray( identifier, old_identifier_case );

        if ( new_identifier_case === "SCREAM_CASE" )
        {
            return identifier_word_array.join( '_' ).toUpperCase();
        }
        else if ( new_identifier_case === "PascalCase" )
        {
            return identifier_word_array.map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( '' );
        }
        else if ( new_identifier_case === "snake_case" )
        {
            return identifier_word_array.join( '_' ).toLowerCase();
        }
        else if ( new_identifier_case === "camelCase" )
        {
            return identifier_word_array[ 0 ].toLowerCase() + identifier_word_array.slice( 1 ).map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( '' );
        }
        else
        {
            return identifier;
        }
    }

    // ~~

    function FixIdentifiers(
        code
        )
    {
        return code.replace(
            /\w+/g,
            function( identifier )
            {
                var
                    identifier_case;

                identifier_case = GetIdentifierCase( identifier );

                if ( identifier_case === "SCREAM_CASE" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, ScreamCaseIdentifierCase );
                }
                else if ( identifier_case === "PascalCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, PascalCaseIdentifierCase );
                }
                else if ( identifier_case === "snake_case" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, SnakeCaseIdentifierCase );
                }
                else if ( identifier_case === "camelCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, CamelCaseIdentifierCase );
                }
                else
                {
                    return identifier;
                }
            }
            );
    }

    // ~~

    function FixCode(
        )
    {
        ScreamCaseIdentifierCase = document.getElementById( "scream-case" ).value,
        PascalCaseIdentifierCase = document.getElementById( "pascal-case" ).value,
        SnakeCaseIdentifierCase = document.getElementById( "snake-case" ).value,
        CamelCaseIdentifierCase = document.getElementById( "camel-case" ).value;

        code = document.getElementById( "old-code" ).value;

        if ( document.getElementById( "braces" ).checked )
        {
            code = FixBraces( code );
        }

        if ( document.getElementById( "brackets" ).checked )
        {
            code = FixBrackets( code );
            code = FixParentheses( code );
        }

        if ( document.getElementById( "identifiers" ).checked )
        {
            code = FixIdentifiers( code );
        }

        document.getElementById( "new-code" ).value = code;
        document.getElementById( "new-code" ).focus();
        document.getElementById( "new-code" ).setSelectionRange( 0, code.length );
        document.execCommand( "copy" );
    }
</script>
