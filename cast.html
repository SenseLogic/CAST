<meta charset="utf-8">
<style>
    *
    {
        padding : 0;
        margin : 0;

        font-family: sans-serif;
    }

    textarea
    {
        height: 100%;
        width: 100%;
    }

    input[ type=checkbox ]
    {
        transform : scale( 0.8 );

        margin-right : 0.5rem;
    }

    .main-grid
    {
        height: 99vh;

        display: grid;
        grid-template-rows: auto 1fr;
        grid-template-columns: 1fr;
    }

    .code-grid
    {
        padding: 1vh;

        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .option-grid
    {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .case-grid
    {
        padding: 1vh;

        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .button-grid
    {
        padding: 1vh;

        display: flex;
        justify-content: end;
        align-items: end;
    }

    .button
    {
        padding: 0.5vh;

        font-size: 1.5vh;
    }
</style>
<div class="main-grid">
    <div class="option-grid">
        <div class="case-grid">
            <div>
                SCREAM_CASE :
            </div>
            <select id="scream-case">
                <option value="SCREAM_CASE" selected>
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                snake_case :
            </div>
            <select id="snake-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case" selected>
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                PascalCase :
            </div>
            <select id="pascal-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase" selected>
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                camelCase :
            </div>
            <select id="camel-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase" selected>
                    camelCase
                </option>
            </select>
        </div>
        <div>
            <div>
                <input id="blocks" type="checkbox" checked/>Blocks
            </div>
            <div>
                <input id="braces" type="checkbox" checked/>Braces
            </div>
            <div>
                <input id="brackets" type="checkbox" checked/>Brackets
            </div>
            <div>
                <input id="parentheses" type="checkbox" checked/>Parentheses
            </div>
            <div>
                <input id="identifiers" type="checkbox"/>Identifiers
            </div>
        </div>
        <div class="button-grid">
            <button class="button" onclick="FixCode()">Fix</button>
        </div>
    </div>
    <div class="code-grid">
        <div>
            <textarea id="old-code" placeholder="Old code" spellcheck="false"></textarea>
        </div>
        <div>
            <textarea id="new-code" placeholder="New code" spellcheck="false"></textarea>
        </div>
    </div>
</div>
<script>
    // -- VARIABLES

    var
        ScreamCaseIdentifierCase,
        PascalCaseIdentifierCase,
        SnakeCaseIdentifierCase,
        CamelCaseIdentifierCase;

    // -- FUNCTIONS

    function FixBlocks(
        code
        )
    {
        return (
            code
                .replace(
                    /^( *)([^\n]*)\{\s*$/gm,
                    function ( match, indentation, code )
                    {
                        if ( code === "" )
                        {
                            return indentation + '{';
                        }
                        else
                        {
                            return indentation + code + '\n' + indentation + '{';
                        }
                    }
                    )
                .replace(
                    /^( *)} else\s*$/gm,
                    function ( match, indentation )
                    {
                        return indentation + '}\n' + indentation + 'else';
                    }
                    )
                .replace(
                    /^( *)}\s*\)(.*)$/gm,
                    function ( match, indentation, code )
                    {
                        return indentation + '}\n' + indentation + ')' + code;
                    }
                    )
                .replace(
                    /[ \t]+$/gm,
                    ''
                    )
            );
    }

    // ~~

    function FixBraces(
        code
        )
    {
        return (
            code
                .replace( /\{(?=[^\s])/g, '{ ' )
                .replace( /(?<=[^\s])\}/g, ' }' )
                .replaceAll( "{ }", "[}" )
            );
    }

    // ~~

    function FixBrackets(
        code
        )
    {
        return (
            code
                .replace( /\[(?=[^\s])/g, '[ ' )
                .replace( /(?<=[^\s])\]/g, ' ]' )
                .replaceAll( "[ ]", "[]" )
            );
    }

    // ~~

    function FixParentheses(
        code
        )
    {
        return (
            code
                .replace( /\((?=[^\s])/g, '( ' )
                .replace( /(?<=[^\s])\)/g, ' )' )
                .replaceAll( "( )", "()" )
            );
    }

    // ~~

    function GetIdentifierCase(
        identifier
        )
    {
        if ( /^[A-Z][A-Z0-9_]+$/.test( identifier ) )
        {
            return "SCREAM_CASE";
        }
        else if ( /^[A-Z][a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "PascalCase";
        }
        else if ( /^[a-z][a-z0-9_]*$/.test( identifier ) )
        {
            return "snake_case";
        }
        else if ( /^[a-z][a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "camelCase";
        }
        else
        {
            return "";
        }
    }

    // ~~

    function GetIdentifierWordArray(
        identifier,
        identifier_case
        )
    {
        if ( identifier_case === "SCREAM_CASE"
             || identifier_case === "snake_case" )
        {
            return identifier.split( '_' );
        }
        else if ( identifier_case === "PascalCase"
                  || identifier_case === "camelCase" )
        {
            return identifier.split( /(?=[A-Z])/ ).map( word => word.toLowerCase() );
        }
        else
        {
            return [ identifier ];
        }
    }

    // ~~

    function GetFixedIdentifier(
        identifier,
        old_identifier_case,
        new_identifier_case
        )
    {
        let identifier_word_array = GetIdentifierWordArray( identifier, old_identifier_case );

        if ( new_identifier_case === "SCREAM_CASE" )
        {
            return identifier_word_array.join( '_' ).toUpperCase();
        }
        else if ( new_identifier_case === "PascalCase" )
        {
            return identifier_word_array.map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( '' );
        }
        else if ( new_identifier_case === "snake_case" )
        {
            return identifier_word_array.join( '_' ).toLowerCase();
        }
        else if ( new_identifier_case === "camelCase" )
        {
            return identifier_word_array[ 0 ].toLowerCase() + identifier_word_array.slice( 1 ).map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( '' );
        }
        else
        {
            return identifier;
        }
    }

    // ~~

    function FixIdentifiers(
        code
        )
    {
        return code.replace(
            /\w+/g,
            function( identifier )
            {
                var
                    identifier_case;

                identifier_case = GetIdentifierCase( identifier );

                if ( identifier_case === "SCREAM_CASE" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, ScreamCaseIdentifierCase );
                }
                else if ( identifier_case === "PascalCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, PascalCaseIdentifierCase );
                }
                else if ( identifier_case === "snake_case" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, SnakeCaseIdentifierCase );
                }
                else if ( identifier_case === "camelCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, CamelCaseIdentifierCase );
                }
                else
                {
                    return identifier;
                }
            }
            );
    }

    // ~~

    function FixCode(
        )
    {
        ScreamCaseIdentifierCase = document.getElementById( "scream-case" ).value,
        PascalCaseIdentifierCase = document.getElementById( "pascal-case" ).value,
        SnakeCaseIdentifierCase = document.getElementById( "snake-case" ).value,
        CamelCaseIdentifierCase = document.getElementById( "camel-case" ).value;

        code = document.getElementById( "old-code" ).value;

        if ( document.getElementById( "blocks" ).checked )
        {
            code = FixBlocks( code );
        }

        if ( document.getElementById( "braces" ).checked )
        {
            code = FixBraces( code );
        }

        if ( document.getElementById( "brackets" ).checked )
        {
            code = FixBrackets( code );
        }

        if ( document.getElementById( "parentheses" ).checked )
        {
            code = FixParentheses( code );
        }

        if ( document.getElementById( "identifiers" ).checked )
        {
            code = FixIdentifiers( code );
        }

        document.getElementById( "new-code" ).value = code;
        document.getElementById( "new-code" ).focus();
        document.getElementById( "new-code" ).setSelectionRange( 0, code.length );
        document.execCommand( "copy" );
    }
</script>
