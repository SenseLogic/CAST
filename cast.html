<meta charset="utf-8">
<style>
    *
    {
        padding : 0;
        margin : 0;

        font-family: sans-serif;
    }

    textarea
    {
        height: 100%;
        width: 100%;
    }

    input[ type=checkbox ]
    {
        transform : scale( 0.8 );

        margin-right : 0.5rem;
    }

    .main-grid
    {
        height: 99vh;

        display: grid;
        grid-template-rows: auto 1fr;
        grid-template-columns: 1fr;
    }

    .code-grid
    {
        padding: 0.5vh 1vh 1vh 1vh;

        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .code-grid *
    {
        font-family: monospace;
    }

    .option-grid
    {
        padding: 1vh;

        display: flex;
        justify-content: space-between;
    }

    .case-grid
    {
        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1vh;
    }

    .button-grid
    {
        padding: 1vh;

        display: flex;
        flex-direction: column;
        justify-content: end;
        align-items: end;
        gap: 1vh;
    }

    .button
    {
        padding: 0.5vh;
    }
</style>
<div class="main-grid">
    <div class="option-grid">
        <div class="case-grid">
            <div>
                Indentation :
            </div>
            <input id="indentation" type="text" value="    "/>
            <div>
                SCREAM_CASE :
            </div>
            <select id="scream-case">
                <option value="SCREAM_CASE" selected>
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                snake_case :
            </div>
            <select id="snake-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case" selected>
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                PascalCase :
            </div>
            <select id="pascal-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase" selected>
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase">
                    camelCase
                </option>
            </select>
            <div>
                camelCase :
            </div>
            <select id="camel-case">
                <option value="SCREAM_CASE">
                    SCREAM_CASE
                </option>
                <option value="PascalCase">
                    PascalCase
                </option>
                <option value="snake_case">
                    snake_case
                </option>
                <option value="camelCase" selected>
                    camelCase
                </option>
            </select>
        </div>
        <div>
            <div>
                <input id="replace-tabs" type="checkbox" checked/>Replace tabs
            </div>
            <div>
                <input id="remove-comments" type="checkbox" checked/>Remove comments
            </div>
            <div>
                <input id="double-leading-spaces" type="checkbox" checked/>Double leading spaces
            </div>
            <div>
                <input id="remove-trailing-spaces" type="checkbox" checked/>Remove trailing spaces
            </div>
            <div>
                <input id="remove-trailing-commas" type="checkbox" checked/>Remove trailing commas
            </div>
            <div>
                <input id="split-braces" type="checkbox" checked/>Split braces
            </div>
            <div>
                <input id="split-brackets" type="checkbox" checked/>Split brackets
            </div>
        </div>
        <div>
        </div>
        <div>
            <div>
                <input id="indent-braces" type="checkbox" checked/>Indent braces
            </div>
            <div>
                <input id="space-braces" type="checkbox" checked/>Space braces
            </div>
            <div>
                <input id="space-brackets" type="checkbox" checked/>Space brackets
            </div>
            <div>
                <input id="space-parentheses" type="checkbox" checked/>Space parentheses
            </div>
            <div>
                <input id="fix-empty-lines" type="checkbox" checked/>Fix empty lines
            </div>
            <div>
                <input id="fix-identifiers" type="checkbox"/>Fix identifiers
            </div>
            <div>
                <input id="copy-result" type="checkbox"/>Copy result
            </div>
        </div>
        <div class="button-grid">
            <button class="button" onclick="CheckAll()">Check all</button>
            <button class="button" onclick="UncheckAll()">Uncheck all</button>
            <button class="button" onclick="FixCode()">Fix</button>
        </div>
    </div>
    <div class="code-grid">
        <div>
            <textarea id="old-code" placeholder="Old code" spellcheck="false"></textarea>
        </div>
        <div>
            <textarea id="new-code" placeholder="New code" spellcheck="false"></textarea>
        </div>
    </div>
</div>
<script>
    // -- VARIABLES

    var
        Indentation,
        ScreamCaseIdentifierCase,
        PascalCaseIdentifierCase,
        SnakeCaseIdentifierCase,
        CamelCaseIdentifierCase;

    // -- FUNCTIONS

    function GetLineIndentation(
        line
        )
    {
        line = line.trimRight();

        return line.slice( 0, line.length - line.trimLeft().length );
    }

    // ~~

    function GetLevelIndentation(
        level
        )
    {
        var
            level_indentation;

        level_indentation = "";

        while ( level > 0 )
        {
            level_indentation += Indentation;

            --level;
        }

        return level_indentation;
    }

    // ~~

    function ReplaceTabs(
        code
        )
    {
        return code.replaceAll( "\t", Indentation );
    }

    // ~~

    function RemoveComments(
        code
        )
    {
        return code.replace( /\/\/.*$/gm, "" );
    }

    // ~~

    function SplitBraces(
        code
        )
    {
        code = RemoveTrailingSpaces( ReplaceTabs( code ) );

        return RemoveTrailingSpaces(
            code
                .replace(
                    /^( *)([^\n]*)\{$/gm,
                    function ( match, indentation, code )
                    {
                        if ( code === "" )
                        {
                            return indentation + "{";
                        }
                        else
                        {
                            return indentation + code + "\n" + indentation + "{";
                        }
                    }
                    )
                .replace(
                    /^( *)\} *else$/gm,
                    function ( match, indentation )
                    {
                        return indentation + "}\n" + indentation + "else";
                    }
                    )
                .replace(
                    /^( *)\} *([^\n]+)$/gm,
                    function ( match, indentation, code )
                    {
                        return indentation + "}\n" + indentation + code;
                    }
                    )
            );
    }

    // ~~

    function SplitBrackets(
        code
        )
    {
        code = RemoveTrailingSpaces( ReplaceTabs( code ) );

        return RemoveTrailingSpaces(
            code
                .replace(
                    /^( *)([^\n]*\() *\[$/gm,
                    function ( match, indentation, code )
                    {
                        return indentation + code + "\n" + indentation + "[";
                    }
                    )
                .replace(
                    /^( *)\] *\)(.*)$/gm,
                    function ( match, indentation, code )
                    {
                        return indentation + "]\n" + indentation + ")" + code;
                    }
                    )
            );
    }

    // ~~

    function DoubleLeadingSpaces(
        code
        )
    {
        code = ReplaceTabs( code );

        return (
            code.replace(
                /^( +)/gm,
                function ( match )
                {
                    return match.replace(/ /g, "  ");
                }
                )
            );
    }

    // ~~

    function RemoveTrailingSpaces(
        code
        )
    {
        code = ReplaceTabs( code );

        return (
            code
                .replace(
                    /[ \t]+$/gm,
                    ""
                    )
            );
    }

    // ~~

    function RemoveTrailingCommas(
        code
        )
    {
        return (
            code
                .replace(
                    /,(?=\s*[)\]}])/gm,
                    ""
                    )
            );
    }

    // ~~

    function IndentBraces(
        code
        )
    {
        var
            level,
            level_array,
            line,
            line_array,
            line_index,
            next_level,
            next_line,
            next_line_array,
            next_line_index;

        line_array = code.split( "\n" );
        level_array = [];
        next_level_array = [];
        level = 0;

        for ( line_index = 0;
              line_index < line_array.length;
              ++line_index )
        {
            line = line_array[ line_index ].trimRight();
            trimmed_line = line.trimLeft();

            line_array[ line_index ] = line;

            next_level = level;

            while ( trimmed_line.endsWith( "(" )
                 || trimmed_line.endsWith( "[" )
                 || trimmed_line.endsWith( "{" ) )
            {
                ++next_level;

                trimmed_line = trimmed_line.slice( 0, -1 );
            }

            while ( trimmed_line.startsWith( ")" )
                    || trimmed_line.startsWith( "]" )
                    || trimmed_line.startsWith( "}" ) )
            {
                --next_level;

                if ( trimmed_line.startsWith( "}" ) )
                {
                    --level;
                }

                trimmed_line = trimmed_line.slice( 1 );
            }

            console.log( line, level, next_level );

            level_array.push( level );
            next_level_array.push( next_level );
            level = next_level;
        }

        for ( line_index = 0;
              line_index < line_array.length;
              ++line_index )
        {
            line = line_array[ line_index ];
            level = level_array[ line_index ];

            line_indentation = GetLineIndentation( line );
            level_indentation = GetLevelIndentation( level );

            if ( line_indentation.length < level_indentation.length )
            {
                added_indentation = level_indentation.slice( 0, level_indentation.length - line_indentation.length );

                for ( next_line_index = line_index;
                      next_line_index < line_array.length;
                      ++next_line_index )
                {
                    next_line = line_array[ next_line_index ];
                    next_level = level_array[ next_line_index ];

                    if ( next_level >= level )
                    {
                        line_array[ next_line_index ] = added_indentation + next_line;
                    }

                    if ( next_level <= level )
                    {
                        break;
                    }
                }
            }
        }

        return line_array.join( '\n' );
    }

    // ~~

    function SpaceBraces(
        code
        )
    {
        return (
            code
                .replace( /\{(?=[^\s])/g, "{ " )
                .replace( /(?<=[^\s])\}/g, " }" )
                .replaceAll( "{ }", "[}" )
            );
    }

    // ~~

    function SpaceBrackets(
        code
        )
    {
        return (
            code
                .replace( /\[(?=[^\s])/g, "[ " )
                .replace( /(?<=[^\s])\]/g, " ]" )
                .replaceAll( "[ ]", "[]" )
            );
    }

    // ~~

    function SpaceParentheses(
        code
        )
    {
        return (
            code
                .replace( /\((?=[^\s])/g, "( " )
                .replace( /(?<=[^\s])\)/g, " )" )
                .replaceAll( "( )", "()" )
            );
    }

    // ~~

    function FixEmptyLines(
        code
        )
    {
        var
            line,
            line_array,
            prior_line;

        line_array = []
        prior_line = "";

        for ( line of code.split( "\n" ) )
        {
            line = line.trimRight();

            if ( line !== ""
                 || prior_line !== "" )
            {
                line_array.push( line );
            }

            prior_line = line;
        }

        return (
            line_array
                .join( '\n' )
                .replaceAll( '{\n\n', '{\n' )
                .replaceAll( '[\n\n', '[\n' )
                .replaceAll( '(\n\n', '(\n' )
                .replace( /\n\n( *)\}/g, '\n$1}' )
                .replace( /\n\n( *)\]/g, '\n$1]' )
                .replace( /\n\n( *)\)/g, '\n$1)' )
            );
    }

    // ~~

    function GetIdentifierCase(
        identifier
        )
    {
        if ( /^[A-Z][A-Z0-9_]+$/.test( identifier ) )
        {
            return "SCREAM_CASE";
        }
        else if ( /^[A-Z][a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "PascalCase";
        }
        else if ( /^[a-z][a-z0-9_]*$/.test( identifier ) )
        {
            return "snake_case";
        }
        else if ( /^[a-z][a-zA-Z0-9]*$/.test( identifier ) )
        {
            return "camelCase";
        }
        else
        {
            return "";
        }
    }

    // ~~

    function GetIdentifierWordArray(
        identifier,
        identifier_case
        )
    {
        if ( identifier_case === "SCREAM_CASE"
             || identifier_case === "snake_case" )
        {
            return identifier.split( "_" );
        }
        else if ( identifier_case === "PascalCase"
                  || identifier_case === "camelCase" )
        {
            return identifier.split( /(?=[A-Z])/ ).map( word => word.toLowerCase() );
        }
        else
        {
            return [ identifier ];
        }
    }

    // ~~

    function GetFixedIdentifier(
        identifier,
        old_identifier_case,
        new_identifier_case
        )
    {
        let identifier_word_array = GetIdentifierWordArray( identifier, old_identifier_case );

        if ( new_identifier_case === "SCREAM_CASE" )
        {
            return identifier_word_array.join( "_" ).toUpperCase();
        }
        else if ( new_identifier_case === "PascalCase" )
        {
            return identifier_word_array.map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( "" );
        }
        else if ( new_identifier_case === "snake_case" )
        {
            return identifier_word_array.join( "_" ).toLowerCase();
        }
        else if ( new_identifier_case === "camelCase" )
        {
            return identifier_word_array[ 0 ].toLowerCase() + identifier_word_array.slice( 1 ).map( word => word.charAt( 0 ).toUpperCase() + word.slice( 1 ).toLowerCase() ).join( "" );
        }
        else
        {
            return identifier;
        }
    }

    // ~~

    function FixIdentifiers(
        code
        )
    {
        return code.replace(
            /\w+/g,
            function( identifier )
            {
                var
                    identifier_case;

                identifier_case = GetIdentifierCase( identifier );

                if ( identifier_case === "SCREAM_CASE" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, ScreamCaseIdentifierCase );
                }
                else if ( identifier_case === "PascalCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, PascalCaseIdentifierCase );
                }
                else if ( identifier_case === "snake_case" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, SnakeCaseIdentifierCase );
                }
                else if ( identifier_case === "camelCase" )
                {
                    return GetFixedIdentifier( identifier, identifier_case, CamelCaseIdentifierCase );
                }
                else
                {
                    return identifier;
                }
            }
            );
    }

    // ~~

    function CheckAll(
        )
    {
        var
            checkbox;

        for ( checkbox of document.querySelectorAll( "input[type=\"checkbox\"]" ) )
        {
            checkbox.checked = true;
        }
    }

    // ~~

    function UncheckAll(
        )
    {
        var
            checkbox;

        for ( checkbox of document.querySelectorAll( "input[type=\"checkbox\"]" ) )
        {
            checkbox.checked = false;
        }
    }

    // ~~

    function FixCode(
        )
    {
        var
            code;

        Indentation = document.getElementById( "indentation" ).value;
        ScreamCaseIdentifierCase = document.getElementById( "scream-case" ).value,
        PascalCaseIdentifierCase = document.getElementById( "pascal-case" ).value,
        SnakeCaseIdentifierCase = document.getElementById( "snake-case" ).value,
        CamelCaseIdentifierCase = document.getElementById( "camel-case" ).value;

        code = document.getElementById( "old-code" ).value;

        if ( document.getElementById( "replace-tabs" ).checked )
        {
            code = ReplaceTabs( code );
        }

        if ( document.getElementById( "remove-comments" ).checked )
        {
            code = RemoveComments( code );
        }

        if ( document.getElementById( "double-leading-spaces" ).checked )
        {
            code = DoubleLeadingSpaces( code );
        }

        if ( document.getElementById( "remove-trailing-spaces" ).checked )
        {
            code = RemoveTrailingSpaces( code );
        }

        if ( document.getElementById( "remove-trailing-commas" ).checked )
        {
            code = RemoveTrailingCommas( code );
        }

        if ( document.getElementById( "split-braces" ).checked )
        {
            code = SplitBraces( code );
        }

        if ( document.getElementById( "split-brackets" ).checked )
        {
            code = SplitBrackets( code );
        }

        if ( document.getElementById( "indent-braces" ).checked )
        {
            code = IndentBraces( code );
        }

        if ( document.getElementById( "space-braces" ).checked )
        {
            code = SpaceBraces( code );
        }

        if ( document.getElementById( "space-brackets" ).checked )
        {
            code = SpaceBrackets( code );
        }

        if ( document.getElementById( "space-parentheses" ).checked )
        {
            code = SpaceParentheses( code );
        }

        if ( document.getElementById( "fix-empty-lines" ).checked )
        {
            code = FixEmptyLines( code );
        }

        if ( document.getElementById( "fix-identifiers" ).checked )
        {
            code = FixIdentifiers( code );
        }

        document.getElementById( "new-code" ).value = code;
        document.getElementById( "new-code" ).focus();

        if ( document.getElementById( "copy-result" ).checked )
        {
            document.getElementById( "new-code" ).setSelectionRange( 0, code.length );
            document.execCommand( "copy" );
        }
    }
</script>
